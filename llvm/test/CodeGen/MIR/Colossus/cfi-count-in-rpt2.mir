# RUN: llc -march=colossus -mattr=ipu1 -run-pass=colossus-counted-loop-mir -x=mir -o - < %s | FileCheck %s --check-prefixes=CHECK,IPU1_2
# RUN: llc -march=colossus -mattr=ipu2 -run-pass=colossus-counted-loop-mir -x=mir -o - < %s | FileCheck %s --check-prefixes=CHECK,IPU1_2


# The constant fold iteration count will not get folded into the rpt instruction
# as it is being used for the shl instruction.

# CHECK:    $m2 = SETZI 2000, 0
# CHECK:    $m1 = SHL $m2, killed $m1, 0
# IPU1_2:   RPT $m2, 2, 1 {

---
name:            test
body:             |
  bb.0:
    liveins: $m0, $m1
  
    $m2 = SETZI 2000, 0
    $m1 = SHL $m2, killed $m1, 0
    $m2 = CLOOP_BEGIN_VALUE killed $m2, 1
    $m3 = ADD_ZI killed $m0, 7996, 0
    $m0 = OR_ZI $mzero, 0, 0
    CLOOP_BEGIN_TERMINATOR $m2, 1
  
  bb.1:
    successors: %bb.1, %bb.2
    liveins: $m0, $m1, $m2, $m3
  
    $m0 = ADD killed $m0, $m1, 0
    $m3, $m4 = LD32STEP_SI $mzero, killed $m3, -1, 0 :: (load 4)
    $m0 = ADD killed $m0, killed $m4, 0
    $m2 = CLOOP_END_VALUE killed $m2, 1
    CLOOP_END_BRANCH $m2, %bb.1, 1
  
  bb.2:
    liveins: $m0
  
    RTN $lr, 0

...
