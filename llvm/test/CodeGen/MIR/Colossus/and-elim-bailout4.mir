# RUN: llc -march=colossus -run-pass=colossus-and-elim -x=mir -o - < %s | FileCheck %s

# Bail out if there is a definition of the source register of the AND with
# immediate 255 further down in the same basic block.

# CHECK: $m1 = LDZ8_ZI killed $m0, $mzero, 0, 0
# CHECK: $m0 = AND_ZI $m1, 255, 0

---
name:            foo
tracksRegLiveness: false
machineFunctionInfo: {}
body:             |
  bb.0.entry:
    $m1 = LDZ8_ZI killed $m0, $mzero, 0, 0
    BR %bb.1, 0

  bb.1:
    $m0 = AND_ZI $m1, 255, 0
    $m1 = ADD_ZI $m0, 1, 0
    $m2 = CMPEQ_ZI $m1, 42, 0
    BRNZ $m2, %bb.1, 0
    BR %bb.2, 0

  bb.2:
    $m0 = COPY $m1
    RTN $lr, 0

...
